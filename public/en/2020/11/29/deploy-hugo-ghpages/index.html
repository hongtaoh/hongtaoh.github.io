<a name="top"></a>
<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>郝鸿涛：Hongtao Hao</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/python.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vega@5.17.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@4.17.0"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.12.2"></script>

<script>hljs.initHighlightingOnLoad();</script>



            <link rel="icon" href="https://hongtaoh.com/ht10.ico">





  </head>
  
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav" >
      <a href="/" class="nav-logo">
        <img src="/media/ht10.png"
         width="50"
         height="50"
         alt="Hongtao Hao">
      </a>

      <ul class="nav-links" >
        
        
           <li><a href="/">Home</a></li>
       
           <li><a href="/en/vitae/">Vitae</a></li>
       
           <li><a href="/en/projects/">Projects</a></li>
       
           <li><a href="/en/blog/">Blog</a></li>
       
           <li><a href="/en/apad/">APAD</a></li>
       
           <li><a href="/cn/blog/">中文</a></li>
       
       
      </ul>
</nav>
      </header>

<main class = "content" role="main">
<div style="text-align: center">

<h1>How to Deploy a Hugo Website via GitHub Pages</h1>

<p>Hongtao Hao 
 / 2020-11-29 </p>

<hr/>
</div>

<span class="article-toolbar">
  
  
  
  
  
  
  
  <a href='https://github.com/hongtaoh/hongtaoh.github.io/edit/sources/content/en/blog/2020-11-29-re-deploy-hugo-github.md'style="font-size: 24px; color: black;" target="_blank"><i class="fa fa-edit" aria-hidden="true" title="Suggest an edit of this page"></i>
  </a>
  
  
  
</span>


<aside class="toc">
Table of Contents:
<nav id="TableOfContents">
  <ul>
    <li><a href="#restore-the-content">Restore the content</a></li>
    <li><a href="#set-up-gh-pages">Set up gh-pages</a></li>
    <li><a href="#automatic-deployment">Automatic deployment</a></li>
  </ul>
</nav>
</aside>


<div class="body-text list-text">
<p><div class="tip">
2021-04-06: As of April 06, 2021, Hugo only <a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#deployment-of-project-pages-from-your-gh-pages-branch" target="_blank" rel="noreferrer noopener">recommends</a>

 deployment with <a href="https://github.com/marketplace/actions/github-pages-action" target="_blank" rel="noreferrer noopener">GitHub Action</a>

.</p>
<p>GitHub Action is superior to the method mentioned below because (1) You don&rsquo;t need to run <code>hugo</code> to build your site locally; (2) It is easier to leave a custom commit message. The method below necessitates a <code>deploy.sh</code> script, which makes a custom message difficult.</p>
<p>Read <a href="/en/2021/04/05/hugo-gh-pages-action/"><em>How to Deploy A Hugo Website Using GitHub Pages Action</em></a>

 for instructions on deploying your site with GitHub Action.
</div></p>
<p><div class="note">
<strong>Background</strong></p>
<p>I had a nightmare yesterday: I messed up the automatic deployment process of my Hugo website. My initial deployment process was based on <a href="https://www.hjdskes.nl/blog/deploying-hugo-on-personal-gh-pages/index.html" target="_blank" rel="noreferrer noopener">this tutorial post</a>

 by <a href="https://www.hjdskes.nl/" target="_blank" rel="noreferrer noopener">Jente Hidskes</a>

. Although it was a little bit outdated and complicated, it served me well. That was until yesterday.</p>
<p>What happened was that I deleted some images from the <code>static</code> folder. What I should have done is simply to run <code>bash deploy.sh</code> to regenerate and update the site. However, I wanted to leave a commit message to myself, so I ran in Terminal <code>git add . &amp; git commit -m &quot;deleting images.&quot; &amp; git push origin master</code>. The thing is, I probably should have used <code>git push origin sources</code> since the <code>sources</code> branch holds my original repository whereas the <code>master</code> branch is in fact the <code>public</code> folder.</p>
<p>I messed it up. Since the <a href="https://www.hjdskes.nl/blog/deploying-hugo-on-personal-gh-pages/index.html" target="_blank" rel="noreferrer noopener">original codes</a>

 for the deployment were very complicated, I wasn&rsquo;t able to fix it myself. I tried so many methods, but they all failed.</p>
<p>So I had to give up and try to deploy it anew.
</div></p>
<p>There are many ways to deploy a Hugo website. The simplest one perhaps is to host it on <a href="https://www.netlify.com/" target="_blank" rel="noreferrer noopener">Netlify</a>

. However, my site deployed by Netlify looks a little bit different from what I see on my local server. So I had to give it up.</p>
<p>I chose to use GitHub Pages. Hugo&rsquo;s <a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#deployment-of-project-pages-from-your-gh-pages-branch" target="_blank" rel="noreferrer noopener">homepage</a>

 detailed three ways to host a Hugo website though GitHub Pages. <a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#github-user-or-organization-pages" target="_blank" rel="noreferrer noopener">The first method</a>

 is to set up two repositories with one being the submodule. I don&rsquo;t like the idea of managing two repositories for my website, so I didn&rsquo;t choose it. <a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#github-project-pages" target="_blank" rel="noreferrer noopener">The second option</a>

, perhaps the easiest one, is to change the publish directory from <code>public</code> to <code>docs</code>, so that GitHub Pages can automatically recognize that the site to deploy is located in the folder of <code>/docs</code>. However, I didn&rsquo;t like the idea of changing the default publish directory either (Yeah, call me picky if you want).</p>
<p>I chose the <a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#deployment-of-project-pages-from-your-gh-pages-branch" target="_blank" rel="noreferrer noopener">third option</a>

, which is to set up a new branch called <code>gh-pages</code> which is essentially the <code>public</code> folder. I will document the steps I took to restore my site&rsquo;s deployment, in case I need to redo it. It may also help others.</p>
<h2 id="restore-the-content">Restore the content<a href="#restore-the-content" class="header-anchor" ariaLabel="Anchor"> # </a></h2>
<p>Since I messed it up, I decided to delete all the content. After having deleted everything manually in the root directory, I ran these:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git add .
git commit -m <span style="color:#ba2121">&#34;Deleting everything.&#34;</span>
git push origin &lt;master-branch&gt;
</code></pre></div><p>The name of my <code>&lt;master-branch&gt;</code> is <code>sources</code>, so I&rsquo;ll use sources in the following parts.</p>
<p>Then, find out the <code>&lt;commit ID&gt;</code> I want to restore. That should be the one before I messed up everything. Run</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git checkout &lt;commit ID&gt; .
</code></pre></div><p>As <a href="https://medium.com/swlh/using-git-how-to-go-back-to-a-previous-commit-8579ccc8180f" target="_blank" rel="noreferrer noopener">this tutorial</a>

 said, do not forget the dot after <code>&lt;commit ID&gt;</code>. Also, there is space before the dot.</p>
<p>After that, delete <code>public</code> before pushing everything to <code>sources</code>: <code>rm -rf public</code>. This is because I don&rsquo;t need <code>public</code> now and if I include it, it will take more time when <code>pushing</code>.</p>
<p>Then, push the restored content to <code>&lt;master branch&gt;</code> branch:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git add .
git commit -m <span style="color:#ba2121">&#34;Restoring.&#34;</span>
git push origin sources
</code></pre></div><h2 id="set-up-gh-pages">Set up gh-pages<a href="#set-up-gh-pages" class="header-anchor" ariaLabel="Anchor"> # </a></h2>
<p>First, delete all the <code>.DS_Store</code> files:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">find . -name .DS_Store -print0 | xargs -0 git rm -f --ignore-unmatch
git add .
git commit -m <span style="color:#ba2121">&#34;Remove .DS_Store from everywhere&#34;</span>
git push origin sources
</code></pre></div><p>The following steps are based on the <a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#deployment-of-project-pages-from-your-gh-pages-branch" target="_blank" rel="noreferrer noopener">official tutorial</a>

. I modified it a little bit.</p>
<p>Then, edit <code>.gitignore</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;public&#34;</span> &gt;&gt; .gitignore
<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;.DS_Store&#34;</span> &gt;&gt; .gitignore
</code></pre></div><p>If you want to edit <code>.gitignore</code> manually, you can use <code>open .gitignore -a TextEdit</code> or <code>open .gitignore -a &quot;Sublime Text&quot;</code>.</p>
<p>Then, build and deploy:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">rm -rf public
git worktree add -B gh-pages public origin/gh-pages
</code></pre></div><p>Regenerate the site and commit the <code>public</code> folder to <code>gh-pages</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hugo
<span style="color:#008000">cd</span> public <span style="color:#666">&amp;&amp;</span> git add --all <span style="color:#666">&amp;&amp;</span> git commit -m <span style="color:#ba2121">&#34;Publishing to gh-pages&#34;</span> <span style="color:#666">&amp;&amp;</span> <span style="color:#008000">cd</span> ..
git push origin gh-pages
</code></pre></div><p>On GitHub, go to Settings → GitHub Pages, then choose &ldquo;gh-pages&rdquo;. The site should be running.</p>
<h2 id="automatic-deployment">Automatic deployment<a href="#automatic-deployment" class="header-anchor" ariaLabel="Anchor"> # </a></h2>
<!--  My steps:
	
delete the copy of _index.markdown
delete codes, stats, and english within `cn`
update the tutorials of github and netlify deployment in chinese
update deploy.sh
delete privacy images
delete the `logo.png` to test the new `deploy.sh`: delete it, run `deploy.sh` and then `git status`
 -->
<p><a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#put-it-into-a-script-1" target="_blank" rel="noreferrer noopener">The script file</a>

 provided is a little bit weird, especially the <code>if statement</code>. If it is there, and I added some content to the root directory, then I cannot deploy.</p>
<p>Also, the guidance of <a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#use-a-custom-domain" target="_blank" rel="noreferrer noopener">Use a Custom Domain</a>

 provided is a little bit confusing. If I add the CNAME file to the <code>static</code> folder, something will go wrong.</p>
<p>The following script is what I came up with, based on the <a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#put-it-into-a-script-1" target="_blank" rel="noreferrer noopener">original one</a>

:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#bc7a00">#!/bin/sh
</span><span style="color:#bc7a00"></span><span style="color:#19177c">MESSAGE</span><span style="color:#666">=</span><span style="color:#ba2121">&#34;Rebuilding site </span><span style="color:#008000;font-weight:bold">$(</span>date<span style="color:#008000;font-weight:bold">)</span><span style="color:#ba2121">&#34;</span>
<span style="color:#19177c">SOURCE</span><span style="color:#666">=</span>sources
git add .
git commit -m <span style="color:#ba2121">&#34;</span><span style="color:#19177c">$MESSAGE</span><span style="color:#ba2121">&#34;</span>
git push origin <span style="color:#ba2121">&#34;</span><span style="color:#19177c">$SOURCE</span><span style="color:#ba2121">&#34;</span>

<span style="color:#008000;font-weight:bold">if</span> <span style="color:#666">[</span> <span style="color:#ba2121">&#34;`git status -s`&#34;</span> <span style="color:#666">]</span>
<span style="color:#008000;font-weight:bold">then</span>
    <span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;The working directory is dirty. Please commit any pending changes.&#34;</span>
    <span style="color:#008000">exit</span> 1;
<span style="color:#008000;font-weight:bold">fi</span>

<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;Deleting old publication&#34;</span>
rm -rf public
mkdir public
git worktree prune
rm -rf .git/worktrees/public/

<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;Checking out gh-pages branch into public&#34;</span>
git worktree add -B gh-pages public origin/gh-pages

<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;Removing existing files&#34;</span>
rm -rf public/*

<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;Generating site&#34;</span>
hugo

<span style="color:#008000">cd</span> public
<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;hongtaoh.com&#34;</span> &gt; CNAME

<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;Updating gh-pages branch&#34;</span>
git add . <span style="color:#666">&amp;&amp;</span> git commit -m <span style="color:#ba2121">&#34;Publishing to gh-pages (publish.sh)&#34;</span>

<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;Pushing to github&#34;</span>
git push --all origin
</code></pre></div>
<p style="color:#777;">Last modified on 2021-10-05</p>
</div>
<a href="#top"><i class="fa fa-chevron-up" style="font-size: 30px; color: black;"></i></a>

</main>

<footer class="footer">
<script src="https://utteranc.es/client.js"
        repo="hongtaoh/hongtaoh.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
  <script type="text/javascript" src="/js/math-code.js"></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/javascript" src="/js/center-img.js"></script>



     <ul class="footer-links">
      
       
       
       
       <li><a href="/en/blog/index.xml" type="application/rss+xml" title="RSS feed">
       Subscribe </a>
       </li>
       
       
       <li>
       
        <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
       
        License
        <i class="fa fa-cc" aria-hidden="true" title="Attribution-NonCommercial-ShareAlike 4.0 International"></i> 
        </a>
       </li>
       
     </ul>
     <div class="copyright-text">
            
            ©
            
            Hongtao Hao
            
            2020-2021
            
     </div>
</footer>






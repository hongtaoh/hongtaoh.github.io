---
title: Understanding igraph's degree distribution function and plotting the distribution in R
author: Hongtao Hao
date: '2020-08-19'
slug: igraph-distribution
categories: []
tags: []
toc: []
---
The R package `igraph` is very useful. However, its `degree` and `degree_distribution` function is not so straightforward. Also, it might be challenging to plot degree distribution. 

## Getting a deeper understanding of `degree()` and `degree_distribution()`

To explore these two function, let's first draw a simple network. 

```{r echo=TRUE, results='hide', error=FALSE, warning=FALSE, message=FALSE}
library(igraph)
```

```{r}
g1 <- graph( edges=c(1,2, 1,3, 2,3, 3,4), n=4, directed=FALSE)
plot(g1)
```
Okay, now let's have a look at its nodes' degrees and its degree distribution. 

```{r}
deg_1 <- degree(g1)
deg_1
```

But does this result mean? It means that the degree of node1 is $2$, the degree of node2 is $2$, the degree of node3 is $3$, and the degree of node4 is $1$.

Okay. Let's have a look at `g1`'s degree distribution:

```{r}
degree_distribution(g1)
```

What does this result mean then? Does it stand for the value of node $1-4$. No. It means the **relative frequency** of all the degrees, i.e., $1, 2, 3$, as is shown in the result of `degree(g1)`. Wait, but there are four values in the result above, $0.00, 0.25, 0.50, 0.25$. Well, this is because the first value is for degree $0$. 

Conclusion: `degree()` will tell us the degree of all the nodes. `degree_distribution()` will tell us the **relative frequency** of all the degrees. 

Then, we may wonder, what if we don't have all the degrees from the minimum to maximum. For example, if we only have degrees of $1,2,4,9$, will the `degree_distribution()` function show us the relative frequency of degree $5$ (which should be zero)?

Let's try.

```{r}
g2 <- graph( edges=c(1,2, 1,3, 2,3, 3,4, 4,5, 4,6, 4,7, 
                     4,8, 4,9, 4,10, 3,11, 2,12,
                     4,13, 4,14, 2,15, 6,12, 7,10), 
             n=15, directed=FALSE)
plot(g2)
```

```{r}
deg_2 <- degree(g2)
deg_2
```

```{r}
degree_distribution(g2)
```

As we can see above, yes, **it will**. It displays relative frequencies for all possible degrees from $0$ to $9$. 

## Plotting the distribution
Let's plot it. 

First, you might be thinking of histogram:

```{r}
hist(degree(g1))
```

However,as we can ses above, it doesn't make much sense because all of the degrees are discrete numbers. Let's try bar plot instead. 

```{r}
t1 <- table (deg_1)
sum(t1)
relafreq_1 <- t1/sum(t1)
barplot(relafreq_1, xlab = "k", ylab = "Relative frequencies", 
        main = "Degree distribution of g1",
        col = "orange")
```

It works. 

Let's plot `g2` as well.

```{r}
t2 <- table (deg_2)
sum(t2)
relafreq_2 <- t2/sum(t2)
barplot(relafreq_2, xlab = "k", ylab = "Relative frequencies", 
        main ="Degree distribution of g2",
        col = "skyblue")
```

We find that the y-axis scale is too short for our values. I found a solution [here](https://stackoverflow.com/a/50193822/13716814). Before looking at the solution, let's first try solving it by ourselves. 

What's the problem here? The problem is that the y-axis scale is too short. To adjust y-axis scale, let's try `ylim` first. 

What do we need to set `ylim`? As [sebkopf](https://stackoverflow.com/users/3239578/sebkopf) noted [here](https://stackoverflow.com/a/23051088/13716814) on [stackoverflow](https://stackoverflow.com/), we simply need to set the minimum and maximum values using, for example, `c()`.  

Naturally, we may think of `max()`. Let's try:

```{r}
barplot(relafreq_2, xlab="k", ylab = "Relative frequencies", 
        main="Degree distribution of g2",
        col = "skyblue",
        ylim = c(0, max(relafreq_2)))
```

The y-axis scale is still too short. 

We may use `max(t2/sum(t2))+0.1`. It of course will be fine here, setting the y-axis scale to be $[0,0.5]$:

```{r}
barplot(relafreq_2, xlab="k", ylab = "Relative frequencies", 
        main="Degree distribution of g2",
        col = "skyblue",
        ylim = c(0, max(relafreq_2+0.1)))
```

However, this method may not be applicable to other situations. Is there a better way? Yes, let's try the `pretty()` function mentioned above. Read [here](https://stat.ethz.ch/R-manual/R-devel/library/base/html/pretty.html) and [here](https://statisticsglobe.com/pretty-r-function) to understand this function. 

Basically, `pretty()` function will return a sequence of values that are equally spaced and cover the minimum and maximum values of our input. For example:

```{r}
a <- c(0,1,2,3,0.5,1.2,0.001)
pretty(a)
c <- 0.1:0.5
pretty(c)
d<- 0:10
pretty(d)
```

Be aware that `pretty()` won't be able to process a list:

```{r}
b <- list(0,1,2,3,0.5,1.2, 0.001)
# pretty(b)
```

Then, what will happen if we use `pretty(t2/sum(t2))`?

```{r}
pretty(t2/sum(t2))
```

It works, right? However, for `ylim`, we need a min and max. How to get them? We can use the [`range()` function](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/range), which will return [a vector](https://rstudio-education.github.io/hopr/r-objects.html#atomic-vectors) that contains the min and max of our input. 

```{r}
barplot(relafreq_2, xlab="k", ylab = "Relative frequencies", 
        main="Degree distribution of g2",
        col = "skyblue",
        ylim = range(pretty(c(0,relafreq_2))))
```

Some of you may wonder, why couldn't we just use range(pretty(relafreq_2)). Well, we could. The thing is, in `g2`, if all degrees have appeared at least once, then using `range(pretty(relafreq_2))` rather than `range(pretty(c(0,relafreq_2)))` means that the start of `ylim` won't be $0$, I guess. So it's safer to use `range(pretty(c(0,relafreq_2)))`.

## Going back to histogram
In the [igraph tutorial](https://kateto.net/networks-r-igraph) by [Dr. Katya Ognyanova](https://kateto.net/), I saw that she showed the node degrees using histograms. 
On second thought, I realized it's not necessarily a bad idea to show node degrees via a histogram. After all, when the size of the network is huge and the node degrees vary greatly, a histogram isn't that much different from a bar plot. 

Why do I say that they are not that different? I'll explain it using an example of a random graph. 

```{r}
set.seed(1234)
random_graph <- sample_gnp(1000, 1/1000, directed = FALSE, loops = FALSE)
plot(random_graph) # It's not very pretty...
```

Let's draw its nodes degree 

```{r}
deg_random <- degree(random_graph)
hist(deg_random, breaks = seq(0,(max(deg_random)+1), by=0.5), 
     main = "Histogram of nodes degree for random_graph",
     xlab = "k",
     col = "skyblue")
```

Then, let's compare the above histogram with the corresponding bar chart:

```{r}
t_random <- table(deg_random)
relafreq_random <- t_random/sum(t_random)
barplot(relafreq_random, xlab = "k",
        ylab = "Relative frequencies",
        main = "Degree distribution of random_graph",
        ylim = range(pretty(c(0,relafreq_random))),
        col = "orange")
```

They are not that different, right? Except for the fact that the histogram captures the absolute frequencies whereas the bar chart displays relative ones. 

If you are careful enough, you'll find that there is a minor issue with the histogram above: the range of [0,1] shows the frequencies of $k=0$ and $k=1$ combined. How to solve this problem? 

We can simply change the breaks. Set it as `breaks = seq(0,(max(deg_random)+1), by=0.5)`. I learned it from [here](https://stackoverflow.com/a/14585847/13716814).

```{r}
hist(deg_random, breaks = seq(-1,(max(deg_random)+1), by=0.5), 
     main = "Histogram of nodes degree for random_graph",
     xlab = "k", 
     col = "skyblue"
     )
```

How to solve the problem that the y-axis scale is too short?

```{r}
hist(deg_random, breaks = seq(-1,(max(deg_random)+1), by=0.5), 
     main = "Histogram of nodes degree for random_graph",
     xlab = "k", 
     col = "skyblue",
     ylim = range(pretty(c(0,table(deg_random))))
     )
```


When deciding on the breaks of the histogram, [Dr. Katya Ognyanova](https://kateto.net/) used `vcount()-1`. This worked in the example she provided but I think it's not the best option. For example, if there are $1,000$ vertices, and the maximum degree is only $100$, we cannot use `vcount()-1`, which is $999$ to denote the max on the `x-axis`. A better alternative might be `breaks=0:max()+1`.

```{r}
hist(deg_2, breaks = seq(-1,(max(deg_2)+1), by=0.5), 
     main="Histogram of node degree",
     xlab = "k",
     col = "skyblue")
```

Then applying it the `g1`:

```{r}
hist(deg_1, breaks = seq(-1,(max(deg_1)+1), by=0.5), 
     main="Histogram of node degree",
     xlab = "k",
     col = "skyblue")
```

## Conclusion

How to draw barplot?

How to draw hist?